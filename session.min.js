/**
 * session.js 0.0.3
 * (c) 2012 Iain, CodeJoust
 * session is freely distributable under the MIT license.
 * Portions of session.js are inspired or borrowed from Underscore.js, and quirksmode.org demo javascript.
 * This version uses google's jsapi library for location services.
 * For details, see: https://github.com/codejoust/session.js
 */
(function(a,b){var c={HTML5Location:!1,IPInfoDBKey:!1,GAPILocation:!0,locationCookie:"location",locationCookieTimeout:2,sessionTimeout:32,sessionCookie:"first_session"},d=function(){a.session&&a.session.options&&g.merge(c,a.session.options),this.modules={apiVersion:.3,locale:f.locale(),currentSession:f.session(),originalSession:f.session(c.sessionCookie,c.sessionTimeout*24*60*60*1e3),browser:f.browser(),plugins:f.plugins(),device:f.device()},c.HTML5Location?this.modules.location=f.HTML5Location():c.IPInfoDBKey?this.modules.location=f.IPInfoDBLocation(c.IPInfoDBKey):c.GAPILocation&&(this.modules.location=f.GAPILocation());var b=0,d,e,h=this,i=function(){b===0&&a.session&&a.session.start&&a.session.start(h.modules)};for(var j in this.modules){d=h.modules[j];if(typeof d=="function")try{b++,d(function(a){h.modules[j]=a,b--,i()})}catch(k){console&&typeof console.log=="function"&&console.log(k)}else h.modules[j]=d}i()},e={detect:function(){return{browser:this.search(this.data.browser),version:this.search(navigator.userAgent)||this.search(navigator.appVersion),os:this.search(this.data.os)}},search:function(a){if(typeof a!="object"){var e=a.indexOf(this.versionString);if(e==-1)return;return parseFloat(a.substring(e+this.versionString.length+1))}for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;this.versionString=a[b].versionSearch||a[b].identity;if(c){if(c.indexOf(a[b].subString)!=-1)return a[b].identity}else if(d)return a[b].identity}},data:{browser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:a.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.userAgent,subString:"iPad",identitiy:"iPad"},{string:navigator.platform,subString:"Linux",identity:"Linux"},{string:navigator.userAgent,subString:"Android",identity:"Android"}]}},f={browser:function(){return e.detect()},locale:function(){var a=(navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage).split("-");return{country:a[1].toLowerCase(),lang:a[0].toLowerCase()}},device:function(){var c={screen:{width:screen.width,height:screen.height}},d=b.documentElement,e=b.getElementsByTagName("body")[0];return c.viewport={width:a.innerWidth||d.clientWidth||e.clientWidth,height:a.innerHeight||d.clientHeight||e.clientHeight},c.isTablet=!!navigator.userAgent.match(/(iPad|SCH-I800|xoom|kindle)/i),c.isPhone=!c.isTablet&&!!navigator.userAgent.match(/(iPhone|iPod|blackberry|android 0.5|htc|lg|midp|mmp|mobile|nokia|opera mini|palm|pocket|psp|sgh|smartphone|symbian|treo mini|Playstation Portable|SonyEricsson|Samsung|MobileExplorer|PalmSource|Benq|Windows Phone|Windows Mobile|IEMobile|Windows CE|Nintendo Wii)/i),c.isMobile=c.isTablet||c.isPhone,c},plugins:function(){var a=function(a){if(navigator.plugins){var b,c=0,d=navigator.plugins.length;for(;c<d;c++){b=navigator.plugins[c];if(b&&b.name&&b.name.toLowerCase().indexOf(a)!==-1)return!0}return!1}return void 0};return{flash:a("flash"),silverlight:a("silverlight"),java:a("java"),quicktime:a("quicktime")}},session:function(c,d){var e=null;typeof c=="string"&&(e=g.getCookie(c));if(e===null){e={visits:1,search:{engine:null,query:null}};var f=[{name:"Google",url:"https?://(?:www.)?(?:images.)?google.(?:com|[a-z]{2}|com?.[a-z]{2})",query:"q"},{name:"Bing",url:"https?://(?:www.)?bing.com",query:"q"},{name:"Yahoo",url:"https?://(?:www.)?(?:.+.)?search.yahoo.(?:com|[a-z]{2}|com?.[a-z]{2})",query:"p"},{name:"AOL",url:"https?://(?:www.)?(?:aol)?search.aol.(?:com|[a-z]{2}|com?.[a-z]{2})",query:"q"},{name:"Ask",url:"https?://(?:www.)?(?:[a-z]+.)?ask.com",query:"q"},{name:"Baidu",url:"https?://(?:www.)?baidu.com",query:"wd"}],i,j,k=0,l=f.length;for(;k<l;k++)i=f[k],j=new RegExp(i.url+"/.*[?&]"+i.query+"=([^&]+)"),j=j.exec(b.referrer),j&&(e.search.engine=i.name,e.search.query=i.query);e.search.engine===null&&(j=new RegExp("[?&](?:q|query|term|p|wd|query|text)=([^&]+)"),j=j.exec(b.referrer),j&&(e.search.engine="Unknown",e.search.query=j)),e.referrer=b.referrer,e.url=a.location.href,e.path=a.location.pathname,e.start=(new Date).getTime(),e.lastVisit=e.start}else e=h.parse(e),e.lastVisit=(new Date).getTime(),e.visits++;return typeof c=="string"&&g.setCookie(c,h.stringify(e),d),e},HTML5Location:function(){return function(a){navigator.geolocation.getCurrentPosition(function(b){b.source="HTML5",a(b)},function(b){c.GAPILocation?f.GAPILocation()(a):a({error:!0,source:"HTML5"})})}},GAPILocation:function(){return function(b){var d=null;g.getCookie(c.locationCookie)?b(h.parse(g.getCookie(c.locationCookie))):(a.gloaderReady=function(){"google"in a&&(a.google.loader.ClientLocation?(a.google.loader.ClientLocation.source="google",b(a.google.loader.ClientLocation)):b({error:!0,source:"google"}),g.setCookie(c.locationCookie,h.stringify(a.google.loader.ClientLocation),c.locationCookieTimeout*60*60*1e3))},g.loadScript("https://www.google.com/jsapi?callback=gloaderReady"))}},IPInfoDBLocation:function(b){return function(d){var e=g.getCookie(c.locationCookie);if(e)return h.parse(e);a.IPInfoReady=function(a){if(a.statusCode==="OK")a.source="IPInfoDB",g.setCookie(c.locationCookie,h.stringify(a),c.locationCookie*60*60*1e3),d(a);else{if(c.GAPILocation)return f.GAPILocation()(d);d({error:!0,source:"IPInfoDB",message:a.statusMessage})}},g.loadScript("http://api.ipinfodb.com/v3/ip-city/?key="+b+"&format=json&callback=ipinfocb")}}},g={trim:function(a){return a.replace(/^\s+|\s+$/g,"")},setCookie:function(a,c,d,e){e=e?"; path="+e:"; path=/";if(d){var f=new Date;f.setTime(f.getTime()+d),d="; expires="+f.toGMTString()}else d="";return b.cookie=a+"="+c+d+e},getCookie:function(a){var c=b.cookie.split(";"),d,e=0,f=c.length;for(;e<f;e++){d=g.trim(c[e]);if(d.indexOf(a)===0)return d.substring(a.length+1,d.length)}return null},loadScript:function(a){var c=b.createElement("script");c.type="text/javascript",c.src=a,b.getElementsByTagName("body")[0].appendChild(c)},merge:function(){var a,b,c,d=arguments[0]||{},e=arguments.length,f=1;for(;f<e;f++)if((a=arguments[f])!=null)for(b in a){c=a[b];if(d===c)continue;c!==void 0&&(d[b]=c)}return d}},h={parse:JSON.parse||function(a){return typeof a!="string"||!a?null:(new Function("return "+a))()},stringify:JSON.stringify||function(a){var b=typeof a;if(b==="object"&&a!==null){var c,d,e=[],f=a&&a.constructor===Array;for(c in a)d=a[c],b=typeof d,b==="string"?d='"'+d+'"':b==="object"&&d!==null&&(d=this.stringify(d)),e.push((f?"":'"'+c+'":')+d);return(f?"[":"{")+e.join(",")+(f?"]":"}")}if(b==="string")return'"'+a+'"'}};new d})(window,document)